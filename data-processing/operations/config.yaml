# Production Configuration for Semantic Search System

aws:
  # Default region for S3 and OpenSearch
  region: ap-southeast-1
  
  # Bedrock uses us-east-1 (Titan models only available there)
  bedrock_region: us-east-1
  
  s3:
    bucket: your-bucket-name  # Replace with your S3 bucket (or set S3_BUCKET_NAME env var)
    data_prefix: data/active_only/
    files:
      - variant.csv
      - variant_image.csv
      - variant_property.csv
      - variant_option.csv
      - variant_affinity.csv
      - variant_file.csv
  
  bedrock:
    text_model_id: amazon.titan-embed-text-v1
    text_embedding_dimension: 1536
    image_model_id: amazon.titan-embed-image-v1
    image_embedding_dimension: 1024
    max_retries: 3
    timeout_seconds: 30
  
  opensearch:
    endpoint: https://your-domain.us-east-1.es.amazonaws.com  # Replace with your OpenSearch endpoint
    # Credentials moved to .env file for security
    # username and password are loaded from environment variables
    use_iam_auth: true  # Set to false if using username/password auth
    indices:
      text_index: product-text-embeddings
      image_index: product-image-embeddings
    
search_query:
  max_results: 50
  response_timeout_seconds: 3
  default_search_mode: hybrid  # Options: knn, bm25, hybrid
  
  # Search strategy weights for hybrid mode
  hybrid_weights:
    knn_weight: 0.6
    bm25_weight: 0.4
  
  # Reciprocal Rank Fusion parameters
  rrf:
    k: 60  # RRF constant
  
  # Result scoring
  min_similarity_score: 0.0  # Return all results above this threshold
  
  # Field boosting for BM25
  field_boosts:
    product_name: 3.0
    variant_name: 2.5
    description: 1.5
    categories: 2.0
    properties: 1.0
  
  # Filter extraction
  filters:
    enabled: true
    price_keywords:
      - under
      - below
      - less than
      - max
      - between
    color_values:
      - grey
      - gray
      - brown
      - white
      - black
      - blue
      - red
      - green
      - beige
      - cream
    material_values:
      - wood
      - leather
      - fabric
      - metal
      - glass
      - plastic
      - rattan
      - marble
    size_values:
      - small
      - medium
      - large
      - king
      - queen
      - single
      - double
    category_values:
      - sofa
      - table
      - chair
      - bed
      - desk
      - cabinet
      - shelf
      - lamp

data_ingestion:
  batch_size: 100
  max_workers: 4
  
embedding_generation:
  batch_size: 25  # Bedrock batch limit
  max_workers: 2
  text_fields:
    - variant_name
    - product_name
    - description
    - aggregated_properties
  
indexing:
  batch_size: 100
  refresh_interval: 1s
  number_of_shards: 2
  number_of_replicas: 1
  
  # KNN settings
  knn:
    method: hnsw
    engine: nmslib
    space_type: l2
    ef_construction: 512
    m: 16

logging:
  level: INFO  # DEBUG, INFO, WARNING, ERROR
  format: json
  cloudwatch:
    enabled: true
    log_group: /aws/semantic-search
    retention_days: 7

monitoring:
  cloudwatch_metrics: true
  metrics:
    - search_latency
    - search_errors
    - embedding_generation_time
    - index_size
    - llm_fallback_count
    - tag_generation_count

# =============================================================================
# NEW FEATURES
# =============================================================================

# Feature 5: LLM Fallback for Intent Extraction
llm_fallback:
  enabled: true
  model_id: anthropic.claude-3-sonnet-20240229-v1:0  # Configurable Claude model
  similarity_threshold: 0.3  # Trigger fallback when top score is below this
  cache_enabled: true
  cache_ttl_seconds: 3600  # 1 hour cache for LLM responses
  max_retries: 2
  timeout_seconds: 30
  
  # Intent mapping knowledge base (abstract terms -> concrete attributes)
  intent_mappings:
    royal:
      - ornate
      - gold accents
      - traditional
      - vintage
      - elegant
      - luxurious
    cozy:
      - soft fabric
      - plush
      - comfortable
      - warm colors
      - cushioned
    minimalist:
      - clean lines
      - simple
      - modern
      - neutral colors
      - sleek
    rustic:
      - wood
      - natural
      - farmhouse
      - distressed
      - handcrafted
    industrial:
      - metal
      - iron
      - raw
      - urban
      - exposed

# Feature 6: Related Search Tags (Google Shopping Style)
related_tags:
  enabled: true
  min_tags: 3
  max_tags: 10
  llm_model_id: anthropic.claude-3-sonnet-20240229-v1:0
  cache_enabled: true
  cache_ttl_seconds: 1800  # 30 minutes cache for tags
  
  # Tag types to generate
  tag_types:
    - categories
    - price_ranges
    - materials
    - styles
    - colors
  
  # Valid catalog values (used for tag validation)
  catalog_values:
    categories:
      - Sofas
      - Tables
      - Chairs
      - Beds
      - Desks
      - Cabinets
      - Shelves
      - Lamps
      - Dining Tables
      - Coffee Tables
      - Side Tables
      - Console Tables
      - Armchairs
      - Dining Chairs
      - Office Chairs
      - Bar Stools
      - Recliners
      - Sectionals
      - 2-Seater
      - 3-Seater
      - King Beds
      - Queen Beds
      - Nightstands
      - Dressers
      - Wardrobes
      - Bookcases
      - TV Units
      - Ottomans
      - Benches
    
    price_ranges:
      - Under $500
      - Under $1,000
      - Under $1,500
      - Under $2,000
      - $500-$1,000
      - $1,000-$2,000
      - $2,000-$3,000
      - Over $3,000
    
    materials:
      - Leather
      - Fabric
      - Wood
      - Metal
      - Glass
      - Marble
      - Rattan
      - Velvet
      - Linen
      - Cotton
      - Walnut
      - Oak
      - Acacia
      - Teak
    
    styles:
      - Modern
      - Traditional
      - Minimalist
      - Scandinavian
      - Industrial
      - Mid-Century
      - Contemporary
      - Rustic
      - Bohemian
      - Coastal
      - Farmhouse
      - Art Deco
      - Swivel
      - Reclining
      - Extendable
      - Modular
    
    colors:
      - Brown
      - Grey
      - White
      - Black
      - Beige
      - Blue
      - Green
      - Navy
      - Cream
      - Tan
      - Charcoal
      - Natural
      - Walnut
      - Oak
